{% extends 'baseE.html.twig' %}

{% block title %}Hello ReviewController!{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
    table {
        border-collapse: collapse;
        width: 100%;
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 5px;
    }
    th, td {
        padding: 12px;
        text-align: left;
    }
    th {
        background-color: #f2f2f2;
        border-bottom: 2px solid #ddd;
    }
    tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    tr:hover {
        background-color: #f5f5f5;
    }
    table img { 
        max-width: 100px;
        height: 150px;
        object-fit: cover;
        display: block;
        margin: auto;
    }
    .btn-danger {
        background-color: #dc3545;
        border-color: #dc3545;
        color: #fff;
    }
    .search-sort-container {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
    }
    .search-form {
        flex: 1;
        margin-right: 10px;
    }
    .sort-dropdown {
        flex: 1;
    }
    table tbody tr {
        cursor: pointer;
    }
    .chart-section {
        margin-top: 20px;
        margin-left: 40px; /* Adjusted margin left */
        margin-right: 40px; /* Adjusted margin right */
    }
</style>

<div class="example-wrapper">
    <table border="1">
        <thead>
            <th>Nombre De Star</th>
            <th>Description Review</th>
            <th>Supprimer</th>
        </thead>
        <tbody>
            {% set totalStars = 0 %}
            {% for review in r %}
            <tr>
                <td>{{ review.nbrStar }}</td>
                <td>{{ review.description }}</td>
                <td>
                    <a href="{{ path('supp_review', {'idReview': review.idReview}) }}" class="btn btn-danger">Supprimer</a>
                </td>
            </tr>
            {% set totalStars = totalStars + review.nbrStar %}
            {% endfor %}
            {% set averageStars = totalStars / r|length %}
        </tbody>
    </table>   
</div>

<!-- Chart Section Begin -->
<div class="example-wrapper chart-section">
    <div class="col-xl-6">
        <div class="card mb-4">
            <div class="card-header">
                <svg class="svg-inline--fa fa-chart-area me-1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="chart-area" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M64 64c0-17.7-14.3-32-32-32S0 46.3 0 64V400c0 44.2 35.8 80 80 80H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H80c-8.8 0-16-7.2-16-16V64zm96 288H448c17.7 0 32-14.3 32-32V251.8c0-7.6-2.7-15-7.7-20.8l-65.8-76.8c-12.1-14.2-33.7-15-46.9-1.8l-21 21c-10 10-26.4 9.2-35.4-1.6l-39.2-47c-12.6-15.1-35.7-15.4-48.7-.6L135.9 215c-5.1 5.8-7.9 13.3-7.9 21.1v84c0 17.7 14.3 32 32 32z"></path></svg><!-- <i class="fas fa-chart-area me-1"></i> Font Awesome fontawesome.com -->
                Statistiques de nos reviews 
            </div>
            <div class="card-body">
                <canvas id="myAreaChart" width="100%" height="40"></canvas>
            </div>
        </div>
    </div>
</div>
<!-- Chart Section End -->

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    var ctx = document.getElementById('myAreaChart');
    var myAreaChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [{% for review in r %}"Review {{ loop.index }}",{% endfor %}],
            datasets: [{
                label: 'Number of Stars',
                data: [{% for review in r %}{{ review.nbrStar }},{% endfor %}],
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
</script>
{% endblock %}
